<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnPro - Play & Earn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; }
        .gradient-text { background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-grad { background-image: linear-gradient(to right, #FF512F 0%, #DD2476 51%, #FF512F 100%); transition: 0.5s; background-size: 200% auto; color: white; border-radius: 10px; }
        .btn-grad:hover { background-position: right center; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden">

    <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10">
        <div class="absolute top-10 left-10 w-32 h-32 bg-purple-600 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob"></div>
        <div class="absolute bottom-10 right-10 w-32 h-32 bg-blue-600 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-2000"></div>
    </div>

    <div id="login-screen" class="text-center w-full max-w-md glass-card p-8 shadow-2xl">
        <div class="mb-6">
            <i class="fas fa-gamepad text-6xl text-blue-400 mb-4"></i>
            <h1 class="text-4xl font-extrabold gradient-text">EarnGamer</h1>
            <p class="text-gray-400 mt-2">Solve Puzzles, Watch Ads, Earn Real Cash</p>
        </div>
        
        <button onclick="googleLogin()" class="w-full bg-white text-gray-900 font-bold py-3 px-6 rounded-xl flex items-center justify-center gap-3 hover:scale-105 transition transform shadow-lg">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-6 h-6" alt="Google">
            Sign in with Google
        </button>
    </div>

    <div id="dashboard-screen" class="hidden w-full max-w-md">
        
        <div class="glass-card p-6 mb-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-20 h-20 bg-white/5 rounded-bl-full"></div>
            <div class="flex items-center gap-4 mb-4">
                <img id="user-photo" src="" class="w-16 h-16 rounded-full border-2 border-blue-400 shadow-lg">
                <div>
                    <h2 class="text-xl font-bold text-white" id="user-name">Loading...</h2>
                    <div class="flex items-center gap-2 text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded-full w-fit">
                        <i class="fas fa-shield-alt text-green-400"></i> Level 1
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mt-4">
                <div class="bg-gray-800/50 p-3 rounded-lg border border-gray-700">
                    <p class="text-xs text-gray-400">Current Balance</p>
                    <p class="text-xl font-bold text-yellow-400">ðŸª™ <span id="user-balance">0</span></p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded-lg border border-gray-700">
                    <p class="text-xs text-gray-400">Total Earned</p>
                    <p class="text-xl font-bold text-green-400">$ <span id="usd-balance">0.00</span></p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div onclick="openGameModal()" class="glass-card p-5 cursor-pointer hover:bg-blue-600/20 transition border border-blue-500/30 group text-center">
                <div class="w-14 h-14 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition">
                    <i class="fas fa-brain text-2xl text-blue-400"></i>
                </div>
                <h3 class="font-bold text-lg">Math Puzzle</h3>
                <p class="text-xs text-gray-400">Solve & Watch Ad (+15 Pts)</p>
            </div>

            <div onclick="watchDirectAd()" class="glass-card p-5 cursor-pointer hover:bg-purple-600/20 transition border border-purple-500/30 group text-center">
                <div class="w-14 h-14 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition">
                    <i class="fas fa-play text-2xl text-purple-400"></i>
                </div>
                <h3 class="font-bold text-lg">Fast Ad</h3>
                <p class="text-xs text-gray-400">Direct Watch (+10 Pts)</p>
            </div>
        </div>

        <button onclick="document.getElementById('withdraw-modal').classList.remove('hidden')" class="w-full btn-grad py-4 font-bold text-lg shadow-lg mb-6">
            <i class="fas fa-wallet mr-2"></i> Withdraw Money
        </button>

        <div id="admin-panel-btn" class="hidden">
            <button onclick="loadAdminPanel()" class="w-full bg-gray-800 border border-red-500 text-red-500 py-3 rounded-lg font-bold hover:bg-red-500 hover:text-white transition">
                <i class="fas fa-user-shield mr-2"></i> Admin Panel Access
            </button>
        </div>
        
        <button onclick="logout()" class="w-full text-gray-500 text-sm mt-4 hover:text-white">Sign Out</button>
    </div>

    <div id="game-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 w-full max-w-sm rounded-2xl p-6 border border-gray-600 relative animate-bounce-in">
            <button onclick="closeGameModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            
            <h3 class="text-2xl font-bold text-center mb-2 text-blue-400">Solve to Earn!</h3>
            <p class="text-center text-gray-400 text-sm mb-6">Solve this simple math to unlock the Ad reward.</p>
            
            <div class="bg-gray-900 p-6 rounded-xl text-center mb-6 border border-gray-700">
                <span id="question-text" class="text-3xl font-mono font-bold tracking-widest">5 + 3 = ?</span>
            </div>

            <input type="number" id="game-answer" placeholder="Enter Answer" class="w-full bg-gray-700 text-white text-center text-xl p-3 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            
            <button onclick="submitAnswer()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition">Submit & Claim</button>
        </div>
    </div>

    <div id="withdraw-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 w-full max-w-sm rounded-2xl p-6 border border-gray-600 relative">
            <button onclick="document.getElementById('withdraw-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button>
            <h3 class="text-xl font-bold mb-4">Request Withdrawal</h3>
            
            <select id="wd-method" class="w-full bg-gray-700 p-3 rounded-lg mb-3 text-white"><option>bKash</option><option>Nagad</option><option>Rocket</option></select>
            <input id="wd-number" type="number" placeholder="Account Number" class="w-full bg-gray-700 p-3 rounded-lg mb-3 text-white">
            <input id="wd-amount" type="number" placeholder="Points (Min 1000)" class="w-full bg-gray-700 p-3 rounded-lg mb-4 text-white">
            
            <button onclick="submitWithdraw()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg">Submit Request</button>
        </div>
    </div>

    <div id="admin-modal" class="hidden fixed inset-0 bg-black/90 z-50 overflow-y-auto p-4">
        <div class="w-full max-w-2xl mx-auto mt-10 bg-gray-900 rounded-xl p-6 border border-gray-700">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-red-500">Admin Dashboard</h2>
                <button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i> Close</button>
            </div>
            
            <div id="admin-content" class="space-y-4">
                <p class="text-center text-gray-500">Loading requests...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, addDoc, getDocs, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyAfWlcUTfoEQIZN0uUvEysn6Bl-yLRUW-U",
          authDomain: "earning-b7215.firebaseapp.com",
          projectId: "earning-b7215",
          storageBucket: "earning-b7215.firebasestorage.app",
          messagingSenderId: "9316337032",
          appId: "1:9316337032:web:dfe33d9685934eec23a63d",
          measurementId: "G-9Z6L345EF1"
        };
        
        const MONETAG_LINK = "https://otieu.com/4/10453862";
        const ADMIN_EMAIL = "mdwld2005@gmail.com"; // <--- CHANGE THIS TO YOUR EMAIL
        // ---------------------

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        let currentUser = null;
        let correctAnswer = 0;

        // AUTH LISTENER
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('dashboard-screen').classList.remove('hidden');
                
                // Set Profile Info
                document.getElementById('user-name').innerText = user.displayName;
                document.getElementById('user-photo').src = user.photoURL;
                
                // Show Admin Button if matched
                if(user.email === ADMIN_EMAIL || user.email === "YOUR_EMAIL_HERE") { 
                    document.getElementById('admin-panel-btn').classList.remove('hidden');
                }

                loadUserData(user);
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('dashboard-screen').classList.add('hidden');
            }
        });

        // LOGIN
        window.googleLogin = () => signInWithPopup(auth, provider).catch(e => alert(e.message));
        window.logout = () => signOut(auth);

        // DATA LOADING
        async function loadUserData(user) {
            const userRef = doc(db, "users", user.uid);
            const snap = await getDoc(userRef);
            if (snap.exists()) {
                const bal = snap.data().balance;
                document.getElementById('user-balance').innerText = bal;
                document.getElementById('usd-balance').innerText = (bal / 1000).toFixed(3); // Demo Rate
            } else {
                await setDoc(userRef, { name: user.displayName, email: user.email, balance: 0 });
                document.getElementById('user-balance').innerText = "0";
            }
        }

        // --- GAME LOGIC ---
        window.openGameModal = () => {
            const num1 = Math.floor(Math.random() * 20) + 1;
            const num2 = Math.floor(Math.random() * 20) + 1;
            correctAnswer = num1 + num2;
            document.getElementById('question-text').innerText = `${num1} + ${num2} = ?`;
            document.getElementById('game-answer').value = "";
            document.getElementById('game-modal').classList.remove('hidden');
        };

        window.closeGameModal = () => document.getElementById('game-modal').classList.add('hidden');

        window.submitAnswer = async () => {
            const ans = parseInt(document.getElementById('game-answer').value);
            if(ans === correctAnswer) {
                // Correct Answer -> Show Ad
                window.open(MONETAG_LINK, '_blank');
                
                // Add Points
                try {
                    const userRef = doc(db, "users", currentUser.uid);
                    await updateDoc(userRef, { balance: increment(15) });
                    document.getElementById('user-balance').innerText = parseInt(document.getElementById('user-balance').innerText) + 15;
                    closeGameModal();
                    // Optional: Show Success Animation
                } catch(e) { console.error(e); }
                
            } else {
                alert("Wrong Answer! Try again.");
            }
        };

        // DIRECT AD
        window.watchDirectAd = async () => {
            window.open(MONETAG_LINK, '_blank');
            const userRef = doc(db, "users", currentUser.uid);
            await updateDoc(userRef, { balance: increment(10) });
            const cur = parseInt(document.getElementById('user-balance').innerText);
            document.getElementById('user-balance').innerText = cur + 10;
        };

        // WITHDRAWAL
        window.submitWithdraw = async () => {
            const amount = parseInt(document.getElementById('wd-amount').value);
            const method = document.getElementById('wd-method').value;
            const number = document.getElementById('wd-number').value;
            const currentBal = parseInt(document.getElementById('user-balance').innerText);

            if(currentBal < amount) { alert("Insufficient Balance!"); return; }
            if(amount < 1000) { alert("Min withdrawal 1000 points."); return; }

            await updateDoc(doc(db, "users", currentUser.uid), { balance: increment(-amount) });
            await addDoc(collection(db, "withdrawals"), {
                uid: currentUser.uid,
                name: currentUser.displayName,
                email: currentUser.email,
                method, number, amount,
                status: "Pending",
                date: new Date().toISOString()
            });
            
            alert("Withdrawal Request Sent!");
            document.getElementById('withdraw-modal').classList.add('hidden');
            document.getElementById('user-balance').innerText = currentBal - amount;
        };

        // --- ADMIN PANEL LOGIC ---
        window.loadAdminPanel = async () => {
            document.getElementById('admin-modal').classList.remove('hidden');
            const container = document.getElementById('admin-content');
            container.innerHTML = '<div class="text-center text-white"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';

            try {
                // Fetch Pending Withdrawals
                const q = query(collection(db, "withdrawals"), where("status", "==", "Pending"));
                const querySnapshot = await getDocs(q);
                
                if(querySnapshot.empty) {
                    container.innerHTML = '<p class="text-gray-400 text-center">No pending requests.</p>';
                    return;
                }

                let html = '';
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    html += `
                    <div class="bg-gray-800 p-4 rounded-lg flex justify-between items-center border border-gray-600 mb-2">
                        <div>
                            <p class="font-bold text-white">${data.name}</p>
                            <p class="text-xs text-gray-400">${data.method} - ${data.number}</p>
                            <p class="text-yellow-400 font-bold">${data.amount} Pts</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="updateStatus('${doc.id}', 'Approved')" class="bg-green-600 px-3 py-1 rounded text-xs hover:bg-green-500">Approve</button>
                            <button onclick="updateStatus('${doc.id}', 'Rejected')" class="bg-red-600 px-3 py-1 rounded text-xs hover:bg-red-500">Reject</button>
                        </div>
                    </div>`;
                });
                container.innerHTML = html;
            } catch (e) {
                container.innerHTML = `<p class="text-red-500">Error: ${e.message}</p>`;
            }
        };

        // Make updateStatus globally available
        window.updateStatus = async (docId, status) => {
            if(!confirm(`Mark this as ${status}?`)) return;
            const wdRef = doc(db, "withdrawals", docId);
            await updateDoc(wdRef, { status: status });
            alert("Updated!");
            loadAdminPanel(); // Reload
        };

    </script>
</body>
</html>
